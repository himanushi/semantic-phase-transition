# CLAUDE.md

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

LLMã®å†…éƒ¨ã«ãŠã‘ã‚‹æ„å‘³å‡¦ç†ã®ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹ã¨é‡ã¿è¡Œåˆ—ã®åœ§ç¸®å¯èƒ½æ€§ã‚’æ¤œè¨¼ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚ç¾åœ¨ã€æ™®éæµ¸é€é–¢æ•° g(l/L) ã«ãŠã‘ã‚‹ Ï€ ã®ç—•è·¡ã‚’æ¢ç´¢ä¸­ã€‚

@README.md

## å®Ÿé¨“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

| å®Ÿé¨“        | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹  | ä¸»è¦çµæœ                                           |
| ----------- | ----------- | -------------------------------------------------- |
| exp1 v2     | âœ… å®Œäº†     | å…¨9èªã§æ‰‡å½¢åˆ†å²ã€‚äºŒæ®µéšæ§‹é€ ã‚’ç™ºè¦‹                  |
| exp2        | âœ… å®Œäº†     | ãƒ©ãƒ³ãƒ€ã‚¦ä»®èª¬æ£„å´ã€‚two_stageãƒ¢ãƒ‡ãƒ«æœ€è‰¯              |
| exp3 + 3EFG | âœ… å®Œäº†     | Ïƒ=hÂ·f_maxÂ·g(l/L)ã®å®Œå…¨åˆ†è§£ã€‚g(l/L)ã®æ™®éæ€§ç¢ºèª     |
| exp4        | â­ ã‚¹ã‚­ãƒƒãƒ— | è‡¨ç•Œãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç„¡ã„ãŸã‚ä¸è¦                         |
| exp5        | â­ ã‚¹ã‚­ãƒƒãƒ— | ç›¸è»¢ç§»ã®å¢ƒç•Œç·šãŒãªã„ãŸã‚ä¸è¦                       |
| exp6        | âœ… å®Œäº†     | PCAåˆ†æ•£â‰ æ©Ÿèƒ½çš„é‡è¦åº¦ã€‚K=140/144ã§ã‚ˆã†ã‚„ãPPL 1.07x |
| exp8A       | âœ… å®Œäº†     | Ïƒ=1/âˆšÏ€ ã‚’æ£„å´ã§ããšï¼ˆp=0.535, 0.245ï¼‰             |
| exp8B       | âœ… å®Œäº†     | medium ã§ sin(Ï€x^Î±/2) ãŒ BIC æœ€è‰¯                  |
| exp8C       | âœ… å®Œäº†     | Î˜/Ï€â‰ˆ1.58ã€æ•´æ•°å€ã«éåæŸã ãŒ Ï€/2 ã«è¿‘ã„            |
| exp9A       | ğŸ”¬ äºˆå®š     | Ïƒ_free ã®4ãƒ¢ãƒ‡ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼ˆColab A100ï¼‰          |
| exp9B       | ğŸ”¬ äºˆå®š     | ç´¯ç©å›è»¢è§’Î˜ã®4ãƒ¢ãƒ‡ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°                   |
| exp9C       | ğŸ”¬ äºˆå®š     | cos_pi_0p ã®å…¨ãƒ¢ãƒ‡ãƒ«æ¤œè¨¼                           |

## ç¾åœ¨ã®ç„¦ç‚¹: exp9ï¼ˆÏ€åæŸæ¤œè¨¼ï¼‰

**æ ¸å¿ƒã®å•ã„**: Ïƒ_free ã¯ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚ºâ†’âˆ ã§ 1/âˆšÏ€ ã«åæŸã™ã‚‹ã‹ï¼Ÿ

**exp8ã®çµæœ**:
1. erf Ïƒ ãŒ 1/âˆšÏ€ ã¨æ•´åˆçš„ï¼ˆ8A: ä¸¡ãƒ¢ãƒ‡ãƒ«ã§æ£„å´ã§ããšï¼‰
2. sin(Ï€x^Î±/2) ãŒ medium ã§ BIC æœ€è‰¯ï¼ˆ8Bï¼‰
3. Î˜/Ï€ â‰ˆ Ï€/2 ã®å¥‡å¦™ãªä¸€è‡´ï¼ˆ8C: å·®0.6%ï¼‰

**exp9ã®æ”»ã‚ç­‹**:
1. exp9A: gpt2/medium/large/xl ã®4ç‚¹ã§ Ïƒ_free ã‚’æ¸¬å®šã—ã€1/n_layersâ†’0 ã¸ã®å¤–æŒ¿
2. exp9B: ç´¯ç©å›è»¢è§’Î˜ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°æ³•å‰‡ã‚’ç‰¹å®š
3. exp9C: ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°ãŒå¢—ãˆã‚‹ã»ã© cos_pi_0p ãŒæœ‰åˆ©ã«ãªã‚‹ã‹æ¤œè¨¼

**å®Ÿè¡Œç’°å¢ƒ**: Google Colab A100ï¼ˆgpt2-xl ã¾ã§å¯¾å¿œï¼‰

## æœ€çµ‚çµè«–ï¼ˆexp1-6ï¼‰

1. **åœ§ç¸®ç›®æ¨™ï¼ˆ100xï¼‰ã¯æœªé”æˆ**: PCAãƒ™ãƒ¼ã‚¹ã®W_QKåœ§ç¸®ã¯åŸç†çš„ã«å›°é›£
2. **æ„å‘³æµ¸é€ã®æ™®éæ³•å‰‡ã‚’ç™ºè¦‹**: Ïƒ(l,h) = h Â· f_max Â· g(l/L)ã€g ã®èªé–“ç›¸é–¢>0.96
3. **ä½åˆ†æ•£æˆåˆ†ãŒæ©Ÿèƒ½ã‚’æ”¯é…**: åˆ†æ•£0.6%ã®æˆåˆ†ã§perplexityãŒ2.2xâ†’1.07xã«å¤‰åŒ–

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- Python 3.10+, PyTorch, transformer-lens, matplotlib, scipy, numpy, scikit-learn, datasets
- å¯¾è±¡ãƒ¢ãƒ‡ãƒ«: GPT-2 (small/medium/large/xl)
- ãƒ‡ãƒã‚¤ã‚¹: M1 Mac ã§ã¯ `--device mps`ã€Colab ã§ã¯ `--device cuda`

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
semantic-phase-transition/
â”œâ”€â”€ README.md
â”œâ”€â”€ CLAUDE.md
â”œâ”€â”€ experiments/
â”‚   â”œâ”€â”€ exp1_basic.py           # å®Ÿé¨“1 åˆæœŸç‰ˆ
â”‚   â”œâ”€â”€ exp1_basic_v2.py        # å®Ÿé¨“1 v2 æ”¹è‰¯ç‰ˆ
â”‚   â”œâ”€â”€ exp2_landau.py          # å®Ÿé¨“2 ãƒ©ãƒ³ãƒ€ã‚¦ãƒ•ã‚£ãƒƒãƒˆ + logit lens
â”‚   â”œâ”€â”€ exp3_linear_response.py # å®Ÿé¨“3 ç·šå½¢å¿œç­”ã®é™ç•Œ
â”‚   â”œâ”€â”€ exp3ef_universal_g.py   # å®Ÿé¨“3E/F/G æ™®éæµ¸é€é–¢æ•°
â”‚   â”œâ”€â”€ exp6_basis.py           # å®Ÿé¨“6 æ™®éåŸºåº• + åœ§ç¸®æ¤œè¨¼
â”‚   â”œâ”€â”€ exp7_residual_pca.py    # å®Ÿé¨“7 æ®‹å·®ã‚¹ãƒˆãƒªãƒ¼ãƒ Î”Ï† PCA
â”‚   â”œâ”€â”€ exp8_pi_trace.py        # å®Ÿé¨“8 Ï€æ¢ç´¢
â”‚   â””â”€â”€ exp9_pi_convergence.py  # å®Ÿé¨“9 Ï€åæŸæ¤œè¨¼ï¼ˆColab A100ç”¨ï¼‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ order_parameter.py
â”‚   â”œâ”€â”€ direction.py
â”‚   â”œâ”€â”€ prompts.py
â”‚   â”œâ”€â”€ fitting.py
â”‚   â””â”€â”€ plotting.py
â”œâ”€â”€ results/
â”‚   â”œâ”€â”€ figures/
â”‚   â””â”€â”€ data/
â””â”€â”€ notebooks/
```

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- è¨€èª: Pythonã€‚ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªOKã€docstringã¯è‹±èª
- å‹ãƒ’ãƒ³ãƒˆæ¨å¥¨
- å®Ÿé¨“ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯argparseã§ `--model`, `--device`, `--output-dir` ã‚’å—ã‘ä»˜ã‘ã‚‹
- çµæœã¯ `results/data/` ã«JSONã€å›³ã¯ `results/figures/` ã«png
- **å®Ÿé¨“ãŒå®Œäº†ã—ãŸã‚‰ `results/exp{N}_results.md` ã«çµæœãƒ¬ãƒãƒ¼ãƒˆã‚’æ›¸ã**ï¼ˆä¾‹: `results/exp8_results.md`ï¼‰

## å°†æ¥ã®ç™ºå±•å¯èƒ½æ€§

- g(l/L)ã®æ™®éæ€§ã‚’ä»–ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆPythia, LLaMAï¼‰ã§æ¤œè¨¼
- f_max(word)ã‚’å¤šæ•°ã®èªã§æ¸¬å®šã—ã€è¨€èªå­¦çš„æ€§è³ªã¨ã®ç›¸é–¢ã‚’åˆ†æ
- PCAä»¥å¤–ã®åˆ†è§£æ‰‹æ³•ï¼ˆICA, sparse codingï¼‰ã§W_QKã®æ©Ÿèƒ½çš„æ§‹é€ ã‚’æ¢ç´¢
- ä½åˆ†æ•£æˆåˆ†ã®ã€Œä¸­èº«ã€ã‚’è§£é‡ˆï¼ˆã©ã®ã‚ˆã†ãªæ³¨æ„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç¬¦å·åŒ–ã—ã¦ã„ã‚‹ã‹ï¼‰
- **exp9ã®çµæœæ¬¡ç¬¬**: è¶…çƒé¢æ‹¡æ•£ãƒ¢ãƒ‡ãƒ«ã®ç†è«–çš„å®šå¼åŒ–
- **exp9**: Ïƒ_free ãŒ 1/âˆšÏ€ ã«åæŸã™ã‚Œã°ã€Pythia/LLaMA ç³»ã§ã‚‚æ¤œè¨¼
