# 実験1: 秩序変数の基本測定 — 結果レポート

## 実験条件

- **モデル**: GPT-2 small (12層, 768次元)
- **デバイス**: CPU
- **対象語**: bank, bat, crane
- **プロンプト種別**: neutral, weak_A, weak_B, strong_A, strong_B (各単語5条件)
- **実行日**: 2026-02-19

## 結果サマリー

| 単語 | cos(ê_A, ê_B) | σ range (max) | 最大ジャンプ層 | パターン判定 |
|------|----------------|---------------|----------------|-------------|
| bank | 0.901 | 0.074 | L10 (finance), L2 (river) | B (漸次的) |
| bat | 0.881 | 0.209 | L0 (animal), L11 (sports) | **A (相転移的)** |
| crane | 0.987 | 0.030 | L0 (全条件) | C (信号不足) |

## 詳細分析

### 1. "bat" — 最も明確な相転移シグナル

**方向ベクトル分離度**: cos(ê_A, ê_B) = 0.881（3語中最良）

**観測されたパターン**:
- 全条件で L0→L1 に大きな正のジャンプ (+0.118) が存在。embedding→最初のレイヤーで「bat」の基本的な意味表現が形成される。
- animal寄りのプロンプト（neutral, weak_A, strong_A）: σ は中間層で +0.23 付近まで単調増加し、L10 付近でピーク後、最終層で下降して σ_final ≈ +0.12 に収束。
- **sports寄りのプロンプト（weak_B, strong_B）: L11→L12 で劇的な負のジャンプ**
  - weak_B ("He swung the bat at"): Δσ = **-0.151** at L11→L12
  - strong_B ("He hit the baseball hard with his bat"): Δσ = **-0.109** at L11→L12
  - σ は中間層まで正のまま推移し、**最終層で突然符号が反転**して負になる

**解釈**:
これは最終層付近での **急激な意味確定** を示唆する。スポーツ文脈の "bat" は、L0〜L10 までは動物の "bat" と類似した表現を維持し、最終層(L11→L12)で一気に "baseball bat" へとスイッチする。これは **一次相転移に近い振る舞い**（パターンA）である。

ただし重要な注意: neutral / weak_A / strong_A はすべて同一のσプロファイルを示す。これはGPT-2がデコーダモデルであり、causal attention maskにより「bat」位置(pos=2)では後続トークンの情報が利用できないため。"The bat flew through" の "flew through" は "bat" の表現に影響しない。

### 2. "bank" — 漸次的な分化

**方向ベクトル分離度**: cos(ê_A, ê_B) = 0.901

**観測されたパターン**:
- neutral ("The bank"): σ は ±0.025 の範囲で変動。ほぼ未決定。
- finance文脈（weak_A, strong_A）: 中間層で緩やかに正方向へ移動し、**L10→L11 で正のジャンプ**（Δσ ≈ +0.025）。σ_final = +0.033〜+0.055。
- river文脈（weak_B, strong_B）: 早い段階から漸次的に負方向へ移動。L5〜L10 で σ ≈ -0.06〜-0.08 に到達。σ_final = -0.040〜-0.043。

**解釈**:
"bank" は相転移というより **crossover（漸次的変化）** に近い（パターンB）。意味の分化は特定のレイヤーに集中せず、複数のレイヤーにわたって段階的に進行する。ただし finance 文脈では L10→L11 に比較的明確なジャンプがあり、弱い二次相転移の可能性も残る。

σ の絶対値は "bat" の 1/3〜1/5 程度であり、方向ベクトルの分離度が低い（cos = 0.90）ことが主因。

### 3. "crane" — 信号不足

**方向ベクトル分離度**: cos(ê_A, ê_B) = 0.987（ほぼ平行）

**観測されたパターン**:
- neutral / weak_A / weak_B: 完全に同一のσプロファイル（全て pos=2 で前文脈が "The" のみ）
- strong_A ("The white crane..."): わずかに正（σ_final = +0.013）
- strong_B ("The construction crane..."): 緩やかに負へ移動（σ_final = -0.013）
- σ の全体的なレンジは最大でも 0.030

**解釈**:
方向ベクトルがほぼ同一方向を向いており（cos = 0.987）、GPT-2 small は "crane" の鳥とクレーンの意味を最終層の残差ストリームにおいて十分に区別できていない可能性がある。信号が小さすぎて、相転移の有無を判定できない（パターンC）。

## 重要な方法論的発見

### Causal Attention Mask の影響

GPT-2 はデコーダモデルであるため、位置 $i$ の残差ストリームには位置 $0, 1, \ldots, i$ のトークン情報のみが含まれる。これにより:

1. **後続文脈は対象トークンの表現に影響しない**
   - "The bat" と "The bat flew through" は、"bat" (pos=2) について完全に同一の σ プロファイルを生成する
   - 意味を曖昧にするプロンプト設計では、**対象語より前に文脈を配置する必要がある**

2. **先行文脈が豊富なプロンプトほど効果的**
   - "He swung the bat at" (bat at pos=4) と "He hit the baseball hard with his bat" (bat at pos=8) はどちらも効果的に σ を変化させた

### 方向ベクトルの分離度が鍵

| cos(ê_A, ê_B) | σ range | 判定可能性 |
|----------------|---------|-----------|
| 0.881 (bat) | 0.209 | 明確に判定可能 |
| 0.901 (bank) | 0.074 | 判定可能だがノイジー |
| 0.987 (crane) | 0.030 | 判定困難 |

方向ベクトルのコサイン類似度が低いほど、秩序変数の感度が高い。実験2以降では **cos(ê_A, ê_B) < 0.92** を目安にプロンプトを選定すべき。

## 結論と次のステップ

### 暫定的結論

1. **"bat" で相転移的振る舞いを検出** — スポーツ文脈において、最終層 (L11→L12) で Δσ ≈ -0.15 の急激なジャンプが観測された。中間層まで正（動物寄り）だった σ が最終層で負（スポーツ寄り）に反転する。
2. **"bank" では crossover 的な漸次変化** — 特定レイヤーへの集中は弱いが、方向性は正しく捕捉されている。
3. **"crane" は方向ベクトルの分離不足** — より大きなモデル、またはより対照的なプロンプトが必要。

### 実験2 (ランダウフィット) への推奨

- **最優先ターゲット**: "bat" のスポーツ文脈 (weak_B, strong_B) のσプロファイル
  - L0〜L10: σ ≈ +0.10〜+0.16（ほぼ一定）
  - L11→L12: 急激なジャンプ
  - tanh モデルでのフィットが適切（ `σ = A * tanh(κ * (l - l_c))` ）
- **サブターゲット**: "bank" の finance 文脈 (weak_A, strong_A)
  - L10→L11 のジャンプを二次相転移モデルでフィット試行
- GPT-2 medium (24層) での再実験により、臨界レイヤーの相対位置 (l_c/L) の普遍性を検証

### 改善事項

1. プロンプト設計の改良: 対象語の**前**に文脈語を配置
2. 方向ベクトルの品質向上: 複数プロンプトの平均を方向ベクトルとして使用
3. より多くの曖昧語でのテスト（spring, rock, match, etc.）

## 生成ファイル

- `results/data/exp1_gpt2.json` — 全数値データ
- `results/figures/sigma_bank_gpt2.png` — "bank" のσプロファイル
- `results/figures/sigma_bat_gpt2.png` — "bat" のσプロファイル
- `results/figures/sigma_crane_gpt2.png` — "crane" のσプロファイル
- `results/figures/dsigma_bank_gpt2.png` — "bank" のdσ/dl
- `results/figures/dsigma_bat_gpt2.png` — "bat" のdσ/dl
- `results/figures/sigma_all_gpt2.png` — 全単語の比較
